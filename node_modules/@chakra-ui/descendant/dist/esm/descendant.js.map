{"version":3,"sources":["../../src/descendant.ts"],"names":["sortNodes","isElement","getNextIndex","getPrevIndex","DescendantsManager","Map","nodeOrOptions","registerNode","node","descendants","delete","sorted","Array","from","keys","assignIndex","clear","forEach","descendant","index","indexOf","dataset","toString","size","enabledValues","length","values","sort","a","b","filter","disabled","count","undefined","enabledCount","item","enabledItem","lastIndex","get","findIndex","i","isSameNode","loop","next","enabledIndex","enabledIndexOf","nextEnabledIndex","prev","prevEnabledIndex","options","has","concat","set"],"mappings":"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","sourcesContent":["import { sortNodes, isElement, getNextIndex, getPrevIndex } from \"./utils\"\n\nexport type DescendantOptions<T = {}> = T & {\n  /**\n   * If `true`, the item will be registered in all nodes map\n   * but omitted from enabled nodes map\n   */\n  disabled?: boolean\n  /**\n   * The id of the item\n   */\n  id?: string\n}\n\nexport type Descendant<T, K> = DescendantOptions<K> & {\n  /**\n   * DOM element of the item\n   */\n  node: T\n  /**\n   * index of item in all nodes map and enabled nodes map\n   */\n  index: number\n}\n\n/**\n * @internal\n *\n * Class to manage descendants and their relative indices in the DOM.\n * It uses `node.compareDocumentPosition(...)` under the hood\n */\nexport class DescendantsManager<\n  T extends HTMLElement,\n  K extends Record<string, any> = {}\n> {\n  private descendants = new Map<T, Descendant<T, K>>()\n\n  register = (nodeOrOptions: T | null | DescendantOptions<K>) => {\n    if (nodeOrOptions == null) return\n\n    if (isElement(nodeOrOptions)) {\n      return this.registerNode(nodeOrOptions)\n    }\n\n    return (node: T | null) => {\n      this.registerNode(node, nodeOrOptions)\n    }\n  }\n\n  unregister = (node: T) => {\n    this.descendants.delete(node)\n    const sorted = sortNodes(Array.from(this.descendants.keys()))\n    this.assignIndex(sorted)\n  }\n\n  destroy = () => {\n    this.descendants.clear()\n  }\n\n  private assignIndex = (descendants: Node[]) => {\n    this.descendants.forEach((descendant) => {\n      const index = descendants.indexOf(descendant.node)\n      descendant.index = index\n      descendant.node.dataset.index = descendant.index.toString()\n    })\n  }\n\n  count = () => this.descendants.size\n\n  enabledCount = () => this.enabledValues().length\n\n  values = () => {\n    const values = Array.from(this.descendants.values())\n    return values.sort((a, b) => a.index - b.index)\n  }\n\n  enabledValues = () => {\n    return this.values().filter((descendant) => !descendant.disabled)\n  }\n\n  item = (index: number) => {\n    if (this.count() === 0) return undefined\n    return this.values()[index]\n  }\n\n  enabledItem = (index: number) => {\n    if (this.enabledCount() === 0) return undefined\n    return this.enabledValues()[index]\n  }\n\n  first = () => this.item(0)\n\n  firstEnabled = () => this.enabledItem(0)\n\n  last = () => this.item(this.descendants.size - 1)\n\n  lastEnabled = () => {\n    const lastIndex = this.enabledValues().length - 1\n    return this.enabledItem(lastIndex)\n  }\n\n  indexOf = (node: T | null) => {\n    if (!node) return -1\n    return this.descendants.get(node)?.index ?? -1\n  }\n\n  enabledIndexOf = (node: T | null) => {\n    if (node == null) return -1\n    return this.enabledValues().findIndex((i) => i.node.isSameNode(node))\n  }\n\n  next = (index: number, loop = true) => {\n    const next = getNextIndex(index, this.count(), loop)\n    return this.item(next)\n  }\n\n  nextEnabled = (index: number, loop = true) => {\n    const item = this.item(index)\n    if (!item) return\n    const enabledIndex = this.enabledIndexOf(item.node)\n    const nextEnabledIndex = getNextIndex(\n      enabledIndex,\n      this.enabledCount(),\n      loop,\n    )\n    return this.enabledItem(nextEnabledIndex)\n  }\n\n  prev = (index: number, loop = true) => {\n    const prev = getPrevIndex(index, this.count() - 1, loop)\n    return this.item(prev)\n  }\n\n  prevEnabled = (index: number, loop = true) => {\n    const item = this.item(index)\n    if (!item) return\n    const enabledIndex = this.enabledIndexOf(item.node)\n    const prevEnabledIndex = getPrevIndex(\n      enabledIndex,\n      this.enabledCount() - 1,\n      loop,\n    )\n    return this.enabledItem(prevEnabledIndex)\n  }\n\n  private registerNode = (node: T | null, options?: DescendantOptions<K>) => {\n    if (!node || this.descendants.has(node)) return\n\n    const keys = Array.from(this.descendants.keys()).concat(node)\n    const sorted = sortNodes(keys)\n\n    if (options?.disabled) {\n      options.disabled = !!options.disabled\n    }\n\n    const descendant = { node, index: -1, ...options }\n\n    this.descendants.set(node, descendant as Descendant<T, K>)\n\n    this.assignIndex(sorted)\n  }\n}\n"],"file":"descendant.js"}